<!DOCTYPE>
 
<html class="no-js">
<head>
    <script src="jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="kinetic-v4.0.3.js" type="text/javascript"></script>
    <title></title>
    <style>
       
    @media screen 
    {
        .hide {display:none}
         .absolute{position:absolute;}
         #txtAnswer {height:4em;font-weight:bold;font-family:verdana;font-size:1em;z-index:100}
         .alignCenter {text-align:center}
         .menu a {border:1px solid red;padding:1em;display:block;width:5em;text-decoration:none;margin:auto;margin-bottom:.6em;}
         #btnCalc {left:540;top:450;}
    }
   
    </style>
    <script type="text/javascript">
        var snackImage = new Image();
        snackImage.src = "snack.png";
        snackImage.width = "30";
        snackImage.height = "30";


        var snackImage2 = new Image();
        snackImage2.src = "snack2.png";
        snackImage2.width = "30";
        snackImage2.height = "30";

        var snackArray = new Array();
        var jar;
        var jarImage = new Image();
        jarImage.src = "jar.png";
        jarImage.width = "90";
        jarImage.height = "108";

        var stage;
        var mathProblemLayer;
        var mathProblemLayer2;
        var comments = generateText("", 200, 100, "blue", 30, "bold", 400);
        
        
        var calcBtn;
        var snackLayer  = new Kinetic.Layer();
        

        var mathObj = {
            x: 430,
            y: 60,
            ops     : "",
            num1    : "",
            num2    : "",
            level   : 1,
            score   : 0,
            counter : 0,
            answer  : 0
        }

    
        function init() {

            stage = new Kinetic.Stage({
                width: 800,
                height: 500,
                container: "canvasContainer"
            });

            
           doBackground();
           setjar();
           setAnswerArea();
	
            doMath();
            // this is for later
           setInterval(function () {
                checkInJar();
            }, 16);  
            
           
          
           mathProblemLayer2 = new Kinetic.Layer();
           
           mathProblemLayer2.add(comments);
          
           stage.add(mathProblemLayer2); 
        }

        function setAnswerArea() {
            var canV = document.getElementById("canvasContainer");
            var $txtAns = $("#txtAnswer");
            $txtAns.css("top",canV.offsetHeight - 120);
            $txtAns.css("left",canV.offsetWidth - 300);
            $txtAns.val("");
           
        }

        function setSnacks2(amount, amount2) {
        	var dy = mathObj.y;
            var maxPerRow = 7;
            var tempImg = new Image();
            var startingX = dx = mathObj.x;
            var indx = 0;
          
            for (var z = amount; z > 0; z--) {
                
                if (indx % maxPerRow == 0) {
                        dy += 50;
                        dx = startingX;
                    }
                    else {
                        dx += 50;
                    }
                 
                if (z <= amount2) {
                    tempImg = snackImage2;
                    amount2--;
                }
                else {
                    tempImg = snackImage;
                }
                
            snackArray[z] = new Kinetic.Image({
                    id: "snack" + z,
                    x: dx,
                    y: dy,
                    image: tempImg,
                    draggable: false
                });
            
                
                snackLayer.add(snackArray[z]);
                stage.add(snackLayer); 
                indx++;
            }
           
        }

        function setjar() {
            jar = new Kinetic.Image({
                image: jarImage,
                x: 200,
                y: 300,
                stroke: "red"
            });

            stage.add(new Kinetic.Layer().add(jar));
        }

        function doBackground() {
            var bg = new Kinetic.Rect({
                height: 500,
                width: 400,
                x: 400,
                y: 0,
                fill: "#cccccc"
            });
            var bgLayer = new Kinetic.Layer();
            bgLayer.add(bg);
            stage.add(bgLayer);
        }

        function checkInJar() {
       	  var txtAns = document.getElementById("txtAnswer");
       	 
            for (var s = 1; s < snackArray.length; s++) {
            	
                if (snackArray[s].getX() < 262 && snackArray[s].getX() > 200 && snackArray[s].getY() > 300 && snackArray[s].getY() < 382) {
            	    snackArray[s].setStroke("red");
                    snackArray[s].hide();
                    
                }
                else {
                    snackArray[s].setStroke("#cccccc");
                }  
            } 
        }

        function doMath() {

            mathObj.num1 = generateRandomNum();
            mathObj.num2 = generateRandomNum();

            switch (mathObj.ops) {
                case "+":
                    {
                        mathObj.answer = mathObj.num1 + mathObj.num2;
                        setSnacks2(mathObj.num1 + mathObj.num2, 0);
                        break;
                    }
                case "-":
                    {
                        if (mathObj.num2 > mathObj.num1) {
                            var tmp = mathObj.num1;
                            mathObj.num1 = mathObj.num2;
                            mathObj.num2 = tmp;
                        }

                        if (mathObj.num2 == mathObj.num1) {
                            mathObj.num1++;
                        }
                        mathObj.answer = mathObj.num1 - mathObj.num2;
                        setSnacks2(mathObj.num1, mathObj.num2);
                        break;
                    }
                case "*":
                    {
                        mathObj.answer = mathObj.num1 * mathObj.num2;
                        setSnacks2(mathObj.num1 * mathObj.num2, "");
                        break;
                    }
                case "/":
                    {
                        break;
                    }
                default: 
                    {
                        break;
                    }
                mathObj.counter++;
            }

            var txtStr = mathObj.num1 + " " + mathObj.ops + " " + mathObj.num2;
            var txtMathProblem = generateText(txtStr, 400, 15, "green", 36, "bold", 400);
              
            mathProblemLayer = new Kinetic.Layer();
            mathProblemLayer.add(txtMathProblem);
            stage.add(mathProblemLayer);

        }

        /* function clearSnacks() {
            snackLayer.remove();
            mathProblemLayer.remove();
            doMath();
        } */

         function checkAnswer() {

            var txtMathProblem;
            var userAnswer = $("#txtAnswer").val();

             if (mathObj.answer == userAnswer) {
               comments.setText("Hey");
               comments.setOpacity(.5);
               stage.draw();
                for (var s = 1; s < snackArray.length; s++) {
                	snackArray[s].setDraggable(true);
                }
                
               
             }
            else {
            	 comments.setText("ddsfsdf");
                 stage.draw();
              }
            
          var timer = setTimeout(function () {
      		  	comments.setText("");
    				stage.draw();
                  }, 1000); 
      	  clearTimeOut(timer);
            
        } 

        function startTimer(){
        
     	 timer = setTimeout(function () {
     		  	comments.setText("");
     		  	stage.draw();
                 }, 1000); 
     	  clearTimeOut(timer);
     	  
        }
     	   

        function generateText(txtStr, dx, dy, fColor, fSize, fStyle, fWidth) {
            return new Kinetic.Text({
                x: dx,
                y: dy,
                text: txtStr,
                fontSize: fSize,
                fontStyle: fStyle,
                fontFamily: "arial",
                textFill: fColor,
                width: fWidth,
                align: 'center'
            });

        }
        function generateRandomNum() {
            // no zeros
            return Math.round(Math.random() * (mathObj.level * 10) + 1 );
          
        }

        $(document).ready(function () {
            $(".mainMenu a").click(function () {
                mathObj.ops = $(this).attr("rel");
                $(".mainMenu").addClass("hide");
                $(".levelSelect").removeClass("hide");
            });

            $(".levelSelect a").click( function () {
                level = $(this).attr("rel");
                $("h3").addClass("hide");
                $(".levelSelect").addClass("hide");
                $("#contentScreen").removeClass("hide");
                init();
            });
            
            $("#btnCalc").click(function() {
            	checkAnswer();
            });  
        });
    </script>
</head>
<body>
    <div class="alignCenter">
        <h3>Cookie Math</h3>
        <h3> </h3>
        <div class="menu mainMenu">
           <a href="#" rel="+">Addition</a>
            <a href="#" rel="-">Subtraction</a>
            <a href="#" rel="*">Multiplication</a>
           
        </div>
        <div class="hide menu levelSelect">
          <a href="#" rel="1">Easy</a>
            <a href="#" rel="2">Medium</a>
            <a href="#" rel="3">I'm good</a>
          
        </div>
    </div>
   Answer correct, then drag items into square.
    <div class="hide" id="contentScreen">
    <div id="canvasContainer" style="border:1px solid red;width:800px;height:500px"></div>
      <input type="text" id="txtAnswer" class="absolute" value=""/>
      <img src="btnCalc.png" class="absolute" id="btnCalc"/>
     </div>
</body>
</html>

